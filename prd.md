# 图片字幕生成器 PRD

## 概述
- 目标：提供一个在线工具，将多行文字以统一背景条的样式叠加到图片底部，形成清晰的“切割感”字幕，并支持预览与保存。
- 使用场景：为社交媒体、文章配图、海报等快速生成带有底部分割字幕的图片。
- 平台：Web（桌面与移动浏览器）。

## 术语
- 字幕条：位于图片底部的矩形背景条，每行文字占用一条，所有条的样式一致。
- 切割感：各行字幕条之间保持等距分隔与统一样式，视觉上像被切割成几条。
- 轮廓颜色：文字描边颜色，用于提升在深色背景上的可读性。

## 目标与非目标
- 目标：快速、稳定地生成“底部多行字幕 + 统一背景条 + 分割间距”的图片；操作简单、直观。
- 非目标：不提供复杂图层管理、滤镜、贴纸等高级图像编辑能力（可列入后续迭代）。

## 用户故事
- 作为用户，我可以上传一张图片。
- 我可以在文本框中输入多行文字，每一行显示成一条统一样式的字幕条。
- 我可以配置字幕条高度、字体大小、字体颜色、轮廓颜色。
- 我点击“生成字幕图”后，能看到预览效果。
- 我点击“保存图片”后，能下载到最终图片文件。

## 功能范围
### 必选功能
- 图片上传：支持拖拽或点击选择，格式 jpg/jpeg/png，最大 10MB。
- 文本输入：多行输入框，按换行分隔为多行字幕。
- 参数配置：
  - 字幕高度（px）：控制每行背景条的高度（默认 40）。
  - 字体大小（px）：控制每行文字字号（默认 20）。
  - 字体颜色：默认 #FFFFFF。
  - 轮廓颜色：默认 #000000。
- 生成预览：在页面中展示带字幕条的图片预览。
- 保存图片：生成并下载 PNG（保持原图分辨率，含透明处理）。

### “切割感”与排版规则（核心）
- 位置：所有字幕条位于图片底部区域，整体自下而上排列。
- 统一样式：所有字幕条背景颜色、透明度、圆角、内边距一致。
- 分割间距：各条之间留出固定间距（默认 4px），形成切割分隔的视觉。
- 宽度：字幕条按图片有效宽度铺满（左右统一边距，默认 32px）。
- 对齐：文字在各条内水平居中、垂直居中显示。
- 行空处理：若某行文字为空，仍保留统一样式的背景条（以保证切割节奏的一致性）。
- 背景颜色（V1 默认值）：rgba(0,0,0,0.75)，暂不开放配置（如需可在后续版本开放）。

### 交互与流程
1. 选择图片或拖拽上传后，显示文件名与缩略预览。
2. 在文本框中输入多行文案；页面实时统计行数。
3. 配置参数（字幕高度、字体大小、字体颜色、轮廓颜色）。
4. 点击“生成字幕图”：在预览区渲染。
5. 点击“保存图片”：导出 PNG 到本地。

## 详细规格
### 表单字段与默认值
- 图片文件：必填，类型 jpg/jpeg/png。
- 字幕高度（px）：数值型，范围 24–120，默认 40。
- 字体大小（px）：数值型，范围 12–72，默认 20。
- 字体颜色：颜色选择器，默认 #FFFFFF。
- 轮廓颜色：颜色选择器，默认 #000000。
- 文案输入：多行文本，按换行分割。最大行数 20，单行最大字符数 60。

### 渲染与布局
- 渲染引擎：HTML Canvas。
- 计算流程：
  1) 读取原图（保持分辨率）。
  2) 依据行数 N，计算底部所需总高度：N × 字幕高度 + (N−1) × 行间距 + 上下边距。
  3) 自底向上绘制每一条字幕背景矩形（统一样式），矩形宽度为图宽 − 2 × 左右边距。
  4) 在各矩形内居中绘制文字；先描边（轮廓颜色），后填充（字体颜色）。
  5) 生成最终画布并用于预览与导出。
- 文本溢出：
  - 不自动换行；若文字测量宽度超过可用宽度，则按比例缩小至不小于最小字体 12px。
  - 若仍超出，尾部使用省略号。

### 错误处理
- 未上传图片时禁用“生成字幕图/保存图片”，并提示上传。
- 文件过大或类型不支持时提示错误。
- 参数为空或非法（非数字）时给出校验提示。

### 非功能需求
- 兼容性：Chrome/Edge/Firefox/Safari 最新两个大版本。
- 性能：1000×1000 图片在 200ms 内完成渲染（中端设备）。
- 稳定性：异常输入不导致页面崩溃；错误信息可见。

## 验收标准
- 多行文字以统一样式的字幕条显示在图片底部，排列自下而上。
- 各字幕条背景颜色、透明度、圆角、内边距一致；条间距一致，视觉呈现明显“切割感”。
- 文字居中、可读性良好；描边与填充颜色生效。
- 未上传图片无法生成或保存；导出 PNG 正常。
- 调整“字幕高度/字体大小/颜色”后，预览与导出结果一致。

## 测试用例（示例）
- 上传 PNG，输入 4 行文字，使用默认参数生成并保存；对比预览与导出一致。
- 修改字幕高度为 60、字体大小为 24，检查条间距与切割感是否保留。
- 输入空行与非空行混合，确认仍保留统一样式的背景条。
- 长文本超过宽度时自动缩小，不低于 12px；仍超出则省略。
- 上传不支持格式（如 gif），提示错误并禁用生成。

## UI 结构（参考）
- 顶部：标题“图片字幕生成器”
- 上传区：文件选择/拖拽，文件名显示
- 参数区：字幕高度、字体大小、字体颜色、轮廓颜色
- 文案区：多行文本框
- 操作区：生成字幕图、保存图片按钮（绿色主色）
- 预览区：生成后的图片展示

## 开发建议（实现要点）
- 使用 CanvasRenderingContext2D：
  - 先 drawImage 原图
  - 逐行绘制背景矩形（统一样式、等距分割）
  - strokeText（轮廓颜色）后 fillText（字体颜色）
- 抽象“测量与缩放”方法：根据可用宽度对单行文字进行宽度测量与字号调整。
- 模块化：上传模块、参数模块、文案模块、渲染模块、导出模块。

## 后续迭代（可选）
- 开放字幕背景颜色与透明度配置
- 支持左右对齐模式切换
- 支持模板保存与一键复用
- 移动端交互优化与一键分享

